#!/usr/bin/env ruby
#
require 'rubygems'
require 'bundler/setup'
require 'dotenv/load'
require 'json'
require 'pry-byebug'

$LOAD_PATH.unshift(File.join(File.dirname(__FILE__), '..', 'lib/'))
require 'runner'
require 'venues'

puts '--> start runner'
vacancies = Runner.new(
  btc: BTCScraper.new
).run

puts '--> write to runner-data.json'
data = {
  vacancies:,
  venues: VENUES.all,
  updated_at: Time.now.strftime('%a %b %d, %Y %I:%M %p')
}
json = JSON.dump(data)
File.write('runner-data.json', json)

# This is a hack writing data into .js instead of .json to avoid CORS check in browser
puts '--> write to runner-data.js'
File.write('runner-data.js', "const runnerData = #{json};")

puts '--> done'
